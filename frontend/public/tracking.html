<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Track your shipment in real-time with Silk Route Logistics. Enter your tracking token for live location, ETA, and milestone updates.">
  <title>Track Shipment — Silk Route Logistics</title>

  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; font-size: 16px; -webkit-font-smoothing: antialiased; }
    body {
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: #E0E7EE; background: #0D1B2A; min-height: 100vh; line-height: 1.6;
    }
    a { text-decoration: none; color: inherit; }
    button { cursor: pointer; border: none; font-family: inherit; }

    :root {
      --navy: #0D1B2A;
      --navy-mid: #1B2838;
      --gold: #C8963E;
      --gold-light: #D4A84E;
      --white: #FFFFFF;
      --light-text: #E0E7EE;
      --muted: #94A3B8;
      --dim: #64748B;
      --font-headline: 'DM Serif Display', Georgia, serif;
      --font-body: 'Plus Jakarta Sans', sans-serif;
      --transition: all 0.3s ease;
      --glass-bg: rgba(255,255,255,0.04);
      --glass-border: rgba(255,255,255,0.08);
      --container: 900px;
    }

    /* NAV */
    .nav {
      background: rgba(13,27,42,0.95); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      padding: 0 24px; position: sticky; top: 0; z-index: 100;
    }
    .nav-inner {
      max-width: 1200px; margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between; height: 64px;
    }
    .nav-logo {
      display: flex; align-items: center; gap: 10px;
      font-weight: 700; font-size: 0.95rem; color: var(--white);
    }
    .logo-gold { color: var(--gold); }
    .nav-links { display: flex; align-items: center; gap: 24px; }
    .nav-links a {
      color: rgba(255,255,255,0.7); font-size: 0.85rem; font-weight: 500;
      transition: color 0.2s;
    }
    .nav-links a:hover, .nav-links a.active { color: var(--gold); }
    .nav-cta {
      background: var(--gold); color: var(--white); padding: 8px 20px;
      border-radius: 6px; font-size: 0.85rem; font-weight: 600;
    }
    .nav-cta:hover { background: var(--gold-light); }

    .hamburger { display: none; flex-direction: column; gap: 4px; background: none; padding: 4px; }
    .hamburger span { width: 22px; height: 2px; background: var(--white); border-radius: 2px; transition: var(--transition); }
    .hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(4px,4px); }
    .hamburger.open span:nth-child(2) { opacity: 0; }
    .hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(4px,-4px); }

    .mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 98; }
    .mobile-overlay.show { display: block; }
    .mobile-menu {
      position: fixed; top: 0; right: -280px; width: 260px; height: 100vh;
      background: var(--navy); z-index: 99; padding: 72px 24px 24px;
      transition: right 0.3s ease;
    }
    .mobile-menu.open { right: 0; }
    .mobile-nav-link {
      display: block; padding: 12px 0; color: rgba(255,255,255,0.7);
      border-bottom: 1px solid rgba(255,255,255,0.06); font-size: 0.95rem;
    }
    .mobile-nav-link:hover { color: var(--gold); }

    /* CONTAINER */
    .container { max-width: var(--container); margin: 0 auto; padding: 32px 24px; }

    /* SEARCH FORM */
    .search-section { text-align: center; padding: 40px 0 20px; }
    .search-section h1 {
      font-family: var(--font-headline); font-size: 2rem; color: var(--white); margin-bottom: 8px;
    }
    .search-section h1 .gold { color: var(--gold); }
    .search-section p { color: var(--muted); font-size: 1rem; margin-bottom: 24px; }
    .search-form {
      display: flex; gap: 12px; max-width: 500px; margin: 0 auto;
    }
    .search-form input {
      flex: 1; padding: 12px 16px; background: var(--glass-bg);
      border: 1px solid var(--glass-border); border-radius: 8px;
      color: var(--white); font-size: 0.95rem; font-family: var(--font-body);
    }
    .search-form input::placeholder { color: var(--dim); }
    .search-form input:focus { outline: none; border-color: var(--gold); }
    .search-form button {
      padding: 12px 24px; background: var(--gold); color: var(--white);
      border-radius: 8px; font-weight: 600; font-size: 0.9rem; transition: var(--transition);
    }
    .search-form button:hover { background: var(--gold-light); }

    /* STATES */
    .loading-state { text-align: center; padding: 80px 20px; color: var(--muted); font-size: 1rem; }
    .loading-state .dot-loader { display: inline-flex; gap: 4px; margin-top: 12px; }
    .loading-state .dot {
      width: 8px; height: 8px; background: var(--gold); border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .loading-state .dot:nth-child(2) { animation-delay: 0.16s; }
    .loading-state .dot:nth-child(3) { animation-delay: 0.32s; }
    @keyframes bounce { 0%,80%,100% { transform: scale(0); } 40% { transform: scale(1); } }

    .error-state { text-align: center; padding: 80px 20px; }
    .error-state h2 { color: #ef4444; font-family: var(--font-headline); margin-bottom: 12px; }
    .error-state p { color: var(--muted); }

    .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); display: none; }
    .empty-state .icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.4; }

    /* STATUS CARD */
    .status-card {
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 12px; padding: 28px; margin-bottom: 24px;
    }
    .ref-number { font-size: 0.8rem; color: var(--gold); font-weight: 700; letter-spacing: 0.5px; margin-bottom: 4px; text-transform: uppercase; }
    .route-line { font-size: 1.5rem; font-weight: 700; color: var(--white); margin-bottom: 16px; font-family: var(--font-headline); }
    .route-line .arrow { color: var(--gold); margin: 0 10px; }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; }
    .info-item label {
      display: block; font-size: 0.7rem; color: var(--dim); text-transform: uppercase;
      letter-spacing: 0.5px; margin-bottom: 4px;
    }
    .info-item span { font-size: 0.95rem; color: var(--light-text); font-weight: 500; }

    /* PROGRESS */
    .progress-section { margin-bottom: 24px; }
    .progress-bar-container {
      display: flex; align-items: center; justify-content: space-between;
      position: relative; padding: 0 20px; margin: 32px 0 16px;
    }
    .progress-line {
      position: absolute; top: 16px; left: 40px; right: 40px;
      height: 3px; background: rgba(255,255,255,0.08); border-radius: 2px;
    }
    .progress-fill {
      height: 100%; background: linear-gradient(90deg, var(--gold), var(--gold-light));
      border-radius: 2px; transition: width 0.8s ease;
    }
    .progress-step { position: relative; z-index: 2; text-align: center; flex: 1; }
    .step-dot {
      width: 32px; height: 32px; border-radius: 50%;
      background: var(--navy-mid); border: 3px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 8px; font-size: 0.8rem; color: var(--muted);
      transition: all 0.3s;
    }
    .step-dot.completed { background: var(--gold); border-color: var(--gold); color: var(--navy); font-weight: 700; }
    .step-dot.active { background: var(--navy); border-color: var(--gold); color: var(--gold); animation: pulse 2s infinite; }
    .step-label { font-size: 0.7rem; color: var(--dim); }
    .step-label.completed { color: var(--gold); }
    .step-label.active { color: var(--gold); font-weight: 600; }
    @keyframes pulse { 0%,100% { box-shadow: 0 0 0 0 rgba(200,150,62,0.4); } 50% { box-shadow: 0 0 0 8px rgba(200,150,62,0); } }

    /* LOCATION & ETA */
    .location-eta { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
    .loc-card, .eta-card {
      background: var(--glass-bg); border: 1px solid var(--glass-border);
      border-radius: 10px; padding: 20px;
    }
    .loc-card h3, .eta-card h3 {
      font-size: 0.7rem; color: var(--dim); text-transform: uppercase;
      letter-spacing: 0.5px; margin-bottom: 10px;
    }
    .loc-value { font-size: 1.15rem; color: var(--white); font-weight: 600; }
    .loc-time { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }

    /* TIMELINE */
    .timeline-section { margin-bottom: 24px; }
    .timeline-section h3 {
      font-size: 0.8rem; color: var(--muted); text-transform: uppercase;
      letter-spacing: 0.5px; margin-bottom: 16px;
    }
    .timeline { position: relative; padding-left: 28px; }
    .timeline::before {
      content: ''; position: absolute; left: 8px; top: 4px; bottom: 4px;
      width: 2px; background: rgba(255,255,255,0.08);
    }
    .timeline-item { position: relative; padding-bottom: 20px; }
    .timeline-item:last-child { padding-bottom: 0; }
    .timeline-dot {
      position: absolute; left: -24px; top: 4px;
      width: 12px; height: 12px; border-radius: 50%;
      background: rgba(255,255,255,0.1);
    }
    .timeline-dot.completed { background: var(--gold); }
    .timeline-item .tl-label { font-size: 0.9rem; color: var(--light-text); font-weight: 500; }
    .timeline-item .tl-sub { font-size: 0.75rem; color: var(--dim); margin-top: 2px; }

    /* CONTACT */
    .contact-section {
      background: rgba(200,150,62,0.06); border: 1px solid rgba(200,150,62,0.15);
      border-radius: 10px; padding: 24px; text-align: center; margin-top: 12px;
    }
    .contact-section h3 { color: var(--gold); font-size: 0.9rem; margin-bottom: 8px; }
    .contact-section p { color: var(--muted); font-size: 0.85rem; }
    .contact-section a { color: var(--gold); font-weight: 600; }

    /* FOOTER */
    .footer {
      text-align: center; padding: 32px 24px; color: var(--dim);
      font-size: 0.75rem; border-top: 1px solid rgba(255,255,255,0.04); margin-top: 40px;
    }
    .footer a { color: var(--gold); }

    @media (max-width: 768px) {
      .nav-links { display: none; }
      .hamburger { display: flex; }
      .location-eta { grid-template-columns: 1fr; }
      .route-line { font-size: 1.2rem; }
      .progress-bar-container { padding: 0 8px; }
      .step-label { font-size: 0.6rem; }
      .search-form { flex-direction: column; }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="nav">
    <div class="nav-inner">
      <a href="/" class="nav-logo">
        <svg width="28" height="28" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="8" fill="#C8963E"/>
          <path d="M10 28L20 12L30 28" stroke="#0D1B2A" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 22H26" stroke="#0D1B2A" stroke-width="2.5" stroke-linecap="round"/>
          <circle cx="20" cy="14" r="2.5" fill="#0D1B2A"/>
        </svg>
      </a>

      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/shippers">Shippers</a>
        <a href="/carriers">Carriers</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
        <a href="/tracking" class="active">Track</a>
        <a href="/shippers" class="nav-cta">Get a Quote</a>
      </div>

      <button class="hamburger" id="hamburger" aria-label="Toggle menu"><span></span><span></span><span></span></button>
    </div>
  </nav>

  <div class="mobile-overlay" id="mobileOverlay"></div>
  <div class="mobile-menu" id="mobileMenu">
    <a href="/" class="mobile-nav-link">Home</a>
    <a href="/shippers" class="mobile-nav-link">Shippers</a>
    <a href="/carriers" class="mobile-nav-link">Carriers</a>
    <a href="/about" class="mobile-nav-link">About</a>
    <a href="/contact" class="mobile-nav-link">Contact</a>
    <a href="/tracking" class="mobile-nav-link">Track Shipment</a>
  </div>

  <div class="container">
    <!-- Search Section -->
    <div class="search-section" id="searchSection">
      <h1>Track Your <span class="gold">Shipment</span></h1>
      <p>Enter your tracking token or use the link provided by your Silk Route Logistics representative.</p>
      <form class="search-form" id="searchForm">
        <input type="text" id="tokenInput" placeholder="Enter tracking token..." autocomplete="off">
        <button type="submit">Track</button>
      </form>
    </div>

    <!-- Empty State (shown when no token) -->
    <div class="empty-state" id="emptyState">
      <div class="icon">&#9878;</div>
      <p>Enter a tracking token above or use the tracking link from your shipment confirmation email.</p>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading-state" style="display:none">
      <div>Loading shipment information...</div>
      <div class="dot-loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
    </div>

    <!-- Error -->
    <div id="error" class="error-state" style="display:none">
      <h2>Shipment Not Found</h2>
      <p>The tracking link may be invalid or expired. Please check the token and try again, or contact your Silk Route Logistics representative.</p>
    </div>

    <!-- Content -->
    <div id="content" style="display:none">
      <div class="status-card">
        <div class="ref-number" id="refNum"></div>
        <div class="route-line"><span id="originCity"></span><span class="arrow">&#8594;</span><span id="destCity"></span></div>
        <div class="info-grid">
          <div class="info-item"><label>Status</label><span id="statusBadge"></span></div>
          <div class="info-item"><label>Equipment</label><span id="equipment"></span></div>
          <div class="info-item"><label>Commodity</label><span id="commodity"></span></div>
          <div class="info-item"><label>Weight</label><span id="weight"></span></div>
          <div class="info-item"><label>Carrier</label><span id="carrier"></span></div>
          <div class="info-item"><label>Shipper</label><span id="shipper"></span></div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-bar-container">
          <div class="progress-line"><div class="progress-fill" id="progressFill"></div></div>
          <div class="progress-step" id="step-booked"><div class="step-dot">1</div><div class="step-label">Booked</div></div>
          <div class="progress-step" id="step-pickup"><div class="step-dot">2</div><div class="step-label">Picked Up</div></div>
          <div class="progress-step" id="step-transit"><div class="step-dot">3</div><div class="step-label">In Transit</div></div>
          <div class="progress-step" id="step-delivered"><div class="step-dot">4</div><div class="step-label">Delivered</div></div>
        </div>
      </div>

      <div class="location-eta">
        <div class="loc-card">
          <h3>Last Known Location</h3>
          <div class="loc-value" id="lastLocation">—</div>
          <div class="loc-time" id="lastLocationTime"></div>
        </div>
        <div class="eta-card">
          <h3>Estimated Delivery</h3>
          <div class="loc-value" id="eta">—</div>
          <div class="loc-time" id="etaNote"></div>
        </div>
      </div>

      <div class="timeline-section">
        <h3>Milestone Timeline</h3>
        <div class="timeline" id="timeline"></div>
      </div>

      <div class="contact-section">
        <h3>Need Help?</h3>
        <p>Contact Silk Route Logistics at <a href="tel:+12692206760">(269) 220-6760</a> or <a href="mailto:info@silkroutelogistics.ai">info@silkroutelogistics.ai</a></p>
      </div>
    </div>
  </div>

  <div class="footer">
    &copy; 2026 Silk Route Logistics LLC &bull; <a href="/">silkroutelogistics.ai</a>
  </div>

  <script>
    (function() {
      'use strict';

      var BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:4000' : 'https://api.silkroutelogistics.ai';

      /* MOBILE MENU */
      var hamburger = document.getElementById('hamburger');
      var mobileMenu = document.getElementById('mobileMenu');
      var overlay = document.getElementById('mobileOverlay');
      function toggleMobile() {
        mobileMenu.classList.toggle('open');
        overlay.classList.toggle('show');
        hamburger.classList.toggle('open');
      }
      hamburger.addEventListener('click', toggleMobile);
      overlay.addEventListener('click', toggleMobile);

      /* TOKEN DETECTION */
      var params = new URLSearchParams(window.location.search);
      var token = params.get('token') || window.location.hash.replace('#', '') || null;

      var tokenInput = document.getElementById('tokenInput');
      var searchForm = document.getElementById('searchForm');
      var emptyState = document.getElementById('emptyState');

      if (token) {
        tokenInput.value = token;
        loadTracking(token);
      } else {
        emptyState.style.display = 'block';
      }

      searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        var val = tokenInput.value.trim();
        if (val) {
          window.history.replaceState(null, '', '/tracking?token=' + encodeURIComponent(val));
          loadTracking(val);
        }
      });

      function loadTracking(trackingToken) {
        emptyState.style.display = 'none';
        document.getElementById('content').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        fetch(BASE + '/api/tracking/' + trackingToken)
          .then(function(res) {
            if (!res.ok) throw new Error('Not found');
            return res.json();
          })
          .then(function(data) { renderTracking(data); })
          .catch(function() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
          });
      }

      function renderTracking(d) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';

        document.getElementById('refNum').textContent = d.referenceNumber;
        document.getElementById('originCity').textContent = d.origin.city + ', ' + d.origin.state;
        document.getElementById('destCity').textContent = d.destination.city + ', ' + d.destination.state;
        document.getElementById('statusBadge').textContent = d.status.replace(/_/g, ' ');
        document.getElementById('equipment').textContent = d.equipment || '—';
        document.getElementById('commodity').textContent = d.commodity || '—';
        document.getElementById('weight').textContent = d.weight ? d.weight.toLocaleString() + ' lbs' : '—';
        document.getElementById('carrier').textContent = d.carrierFirstName || '—';
        document.getElementById('shipper').textContent = d.shipperName || '—';

        // Progress bar
        var statusMap = {
          BOOKED: 0, CONFIRMED: 0, TENDERED: 0, DISPATCHED: 0,
          AT_PICKUP: 1, LOADED: 1, PICKED_UP: 1,
          IN_TRANSIT: 2, AT_DELIVERY: 2,
          DELIVERED: 3, POD_RECEIVED: 3, INVOICED: 3, COMPLETED: 3
        };
        var stepIndex = statusMap[d.status] !== undefined ? statusMap[d.status] : -1;
        var steps = ['booked', 'pickup', 'transit', 'delivered'];
        var pct = stepIndex >= 0 ? (stepIndex / (steps.length - 1)) * 100 : 0;
        document.getElementById('progressFill').style.width = pct + '%';

        steps.forEach(function(s, i) {
          var el = document.getElementById('step-' + s);
          var dot = el.querySelector('.step-dot');
          var label = el.querySelector('.step-label');
          if (i < stepIndex) {
            dot.classList.add('completed'); label.classList.add('completed');
            dot.innerHTML = '&#10003;';
          } else if (i === stepIndex) {
            dot.classList.add('active'); label.classList.add('active');
          }
        });

        // Location
        if (d.lastLocation) {
          document.getElementById('lastLocation').textContent =
            (d.lastLocation.city || '') + (d.lastLocation.state ? ', ' + d.lastLocation.state : '');
          if (d.lastLocation.updatedAt) {
            document.getElementById('lastLocationTime').textContent =
              'Updated ' + new Date(d.lastLocation.updatedAt).toLocaleString();
          }
        }

        // ETA
        if (d.estimatedDelivery) {
          document.getElementById('eta').textContent =
            new Date(d.estimatedDelivery).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }
        if (d.actualDelivery) {
          document.getElementById('eta').textContent = 'Delivered';
          document.getElementById('etaNote').textContent =
            new Date(d.actualDelivery).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' });
        }

        // Timeline
        var timelineEl = document.getElementById('timeline');
        timelineEl.innerHTML = '';
        if (d.milestones) {
          d.milestones.forEach(function(m) {
            var item = document.createElement('div');
            item.className = 'timeline-item';
            var dotClass = m.completed ? 'timeline-dot completed' : 'timeline-dot';
            item.innerHTML = '<div class="' + dotClass + '"></div>' +
              '<div class="tl-label">' + m.label + '</div>' +
              '<div class="tl-sub">' + (m.completed ? 'Completed' : 'Pending') + '</div>';
            timelineEl.appendChild(item);
          });
        }

        // Check calls
        if (d.checkCalls && d.checkCalls.length > 0) {
          var ccHeader = document.createElement('h3');
          ccHeader.style.cssText = 'font-size:0.8rem;color:#94a3b8;text-transform:uppercase;letter-spacing:0.5px;margin:24px 0 16px;';
          ccHeader.textContent = 'Recent Updates';
          timelineEl.parentNode.appendChild(ccHeader);

          var ccTimeline = document.createElement('div');
          ccTimeline.className = 'timeline';
          d.checkCalls.slice(0, 10).forEach(function(cc) {
            var item = document.createElement('div');
            item.className = 'timeline-item';
            var loc = (cc.city || '') + (cc.state ? ', ' + cc.state : '');
            item.innerHTML = '<div class="timeline-dot completed"></div>' +
              '<div class="tl-label">' + (cc.status || 'Update') + (loc ? ' — ' + loc : '') + '</div>' +
              '<div class="tl-sub">' + new Date(cc.timestamp).toLocaleString() + '</div>';
            ccTimeline.appendChild(item);
          });
          timelineEl.parentNode.appendChild(ccTimeline);
        }
      }
    })();
  </script>
<link rel="stylesheet" href="/shared/css/marco-polo.css">
<script src="/shared/js/marco-polo.js"></script>
<script src="/js/cookie-consent.js"></script>
</body>
</html>
